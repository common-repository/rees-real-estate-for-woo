/*
 * Pannellum 2.5.6, https://github.com/mpetroff/pannellum
 * libpannellum - A WebGL and CSS 3D transform based Panorama Renderer
 * Copyright (c) 2012-2022 Matthew Petroff
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
window.libpannellum=function(e,t,n){"use strict";function o(o){var h,d,u,f,p,$,m,_,v,g,y,w,x,b,E,P,R=t.createElement("canvas");function T(e,t){return 1==e.level&&1!=t.level?-1:1==t.level&&1!=e.level?1:t.timestamp-e.timestamp}function L(e,t){return e.level!=t.level?e.level-t.level:e.diff-t.diff}function C(e,t,n,o,i,a){this.vertices=e,this.side=t,this.level=n,this.x=o,this.y=i,this.path=a.replace("%s",t).replace("%l",n).replace("%x",o).replace("%y",i)}function I(e,t,n,o,i){if(function e(t,n){var o=N(t,n.slice(0,3)),i=N(t,n.slice(3,6)),a=N(t,n.slice(6,9)),r=N(t,n.slice(9,12)),s=o[0]+i[0]+a[0]+r[0];if(-4==s||4==s)return!1;var l=o[1]+i[1]+a[1]+r[1];return -4!=l&&4!=l&&4!=o[2]+i[2]+a[2]+r[2]}(e,t.vertices)){var a=t.vertices,r=a[0]+a[3]+a[6]+a[9],s=a[1]+a[4]+a[7]+a[10],l=a[2]+a[5]+a[8]+a[11],c=Math.asin(l/Math.sqrt(r*r+s*s+l*l)),d=Math.atan2(s,r)-o;d+=d>Math.PI?-2*Math.PI:d<-Math.PI?2*Math.PI:0,d=Math.abs(d),t.diff=Math.acos(Math.sin(n)*Math.sin(c)+Math.cos(n)*Math.cos(c)*Math.cos(d));for(var u=!1,f=0;f<h.nodeCache.length;f++)if(h.nodeCache[f].path==t.path){u=!0,h.nodeCache[f].timestamp=h.nodeCacheTimestamp++,h.nodeCache[f].diff=t.diff,h.currentNodes.push(h.nodeCache[f]);break}if(u||(t.timestamp=h.nodeCacheTimestamp++,h.currentNodes.push(t),h.nodeCache.push(t)),t.level<h.level){var p,$,m=v.cubeResolution*Math.pow(2,t.level-v.maxLevel),_=Math.ceil(m*v.invTileResolution)-1,g=m%v.tileResolution*2,y=2*m%v.tileResolution;0===y&&(y=v.tileResolution),0===g&&(g=2*v.tileResolution);var w=.5;(t.x==_||t.y==_)&&(w=1-v.tileResolution/(v.tileResolution+y));var x=1-w,b=[],E=w,P=w,R=w,T=x,L=x,A=x;y<v.tileResolution&&(t.x==_&&t.y!=_?(P=.5,L=.5,("d"==t.side||"u"==t.side)&&(R=.5,A=.5)):t.x!=_&&t.y==_&&(E=.5,T=.5,("l"==t.side||"r"==t.side)&&(R=.5,A=.5))),g<=v.tileResolution&&(t.x==_&&(E=0,T=1,("l"==t.side||"r"==t.side)&&(R=0,A=1)),t.y==_&&(P=0,L=1,("d"==t.side||"u"==t.side)&&(R=0,A=1))),p=[a[0],a[1],a[2],a[0]*E+a[3]*T,a[1]*w+a[4]*x,a[2]*R+a[5]*A,a[0]*E+a[6]*T,a[1]*P+a[7]*L,a[2]*R+a[8]*A,a[0]*w+a[9]*x,a[1]*P+a[10]*L,a[2]*R+a[11]*A],b.push($=new C(p,t.side,t.level+1,2*t.x,2*t.y,v.fullpath)),t.x==_&&g<=v.tileResolution||(p=[a[0]*E+a[3]*T,a[1]*w+a[4]*x,a[2]*R+a[5]*A,a[3],a[4],a[5],a[3]*w+a[6]*x,a[4]*P+a[7]*L,a[5]*R+a[8]*A,a[0]*E+a[6]*T,a[1]*P+a[7]*L,a[2]*R+a[8]*A],b.push($=new C(p,t.side,t.level+1,2*t.x+1,2*t.y,v.fullpath))),t.x==_&&g<=v.tileResolution||t.y==_&&g<=v.tileResolution||(p=[a[0]*E+a[6]*T,a[1]*P+a[7]*L,a[2]*R+a[8]*A,a[3]*w+a[6]*x,a[4]*P+a[7]*L,a[5]*R+a[8]*A,a[6],a[7],a[8],a[9]*E+a[6]*T,a[10]*w+a[7]*x,a[11]*R+a[8]*A],b.push($=new C(p,t.side,t.level+1,2*t.x+1,2*t.y+1,v.fullpath))),t.y==_&&g<=v.tileResolution||(p=[a[0]*w+a[9]*x,a[1]*P+a[10]*L,a[2]*R+a[11]*A,a[0]*E+a[6]*T,a[1]*P+a[7]*L,a[2]*R+a[8]*A,a[9]*E+a[6]*T,a[10]*w+a[7]*x,a[11]*R+a[8]*A,a[9],a[10],a[11]],b.push($=new C(p,t.side,t.level+1,2*t.x,2*t.y+1,v.fullpath)));for(var S=0;S<b.length;S++)I(e,b[S],n,o,i)}}}function A(){return[-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1]}function S(e,t,n){var o=Math.sin(t),i=Math.cos(t);return"x"==n?[e[0],i*e[1]+o*e[2],i*e[2]-o*e[1],e[3],i*e[4]+o*e[5],i*e[5]-o*e[4],e[6],i*e[7]+o*e[8],i*e[8]-o*e[7]]:"y"==n?[i*e[0]-o*e[2],e[1],i*e[2]+o*e[0],i*e[3]-o*e[5],e[4],i*e[5]+o*e[3],i*e[6]-o*e[8],e[7],i*e[8]+o*e[6]]:"z"==n?[i*e[0]+o*e[1],i*e[1]-o*e[0],e[2],i*e[3]+o*e[4],i*e[4]-o*e[3],e[5],i*e[6]+o*e[7],i*e[7]-o*e[6],e[8]]:void 0}function k(e){return[e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]]}R.style.width=R.style.height="100%",o.appendChild(R),this.init=function(e,T,L,C,I,S,k,O){if(T===n&&(T="equirectangular"),"equirectangular"!=T&&"cubemap"!=T&&"multires"!=T)throw console.log("Error: invalid image type specified!"),{type:"config error"};if(g=T,v=e,y=L,P=O||{},h){if(u&&(d.detachShader(h,u),d.deleteShader(u)),f&&(d.detachShader(h,f),d.deleteShader(f)),d.bindBuffer(d.ARRAY_BUFFER,null),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null),h.texture&&d.deleteTexture(h.texture),h.nodeCache)for(var U=0;U<h.nodeCache.length;U++)d.deleteTexture(h.nodeCache[U].texture);d.deleteProgram(h),h=n}_=n;var D=!1;if("cubemap"==g)for(z=0;z<6;z++)v[z].width>0?(F===n&&(F=v[z].width),F!=v[z].width&&console.log("Cube faces have inconsistent widths: "+F+" vs. "+v[z].width)):D=!0;function N(e){if(D){var t=e*e*4,n=new Uint8ClampedArray(t),o=O.backgroundColor?O.backgroundColor:[0,0,0];o[0]*=255,o[1]*=255,o[2]*=255;for(var i=0;i<t;i++)n[i++]=o[0],n[i++]=o[1],n[i++]=o[2];var a=new ImageData(n,e,e);for(z=0;z<6;z++)0==v[z].width&&(v[z]=a)}}if(!("cubemap"==g&&(F&F-1)!=0&&(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 9_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 10_/)||navigator.userAgent.match(/Trident.*rv[ :]*11\./)))&&(d||(d=R.getContext("experimental-webgl",{alpha:!1,depth:!1})),d&&1286==d.getError()&&B()),!d&&("multires"==g&&v.hasOwnProperty("fallbackPath")||"cubemap"==g)&&("WebkitAppearance"in t.documentElement.style||navigator.userAgent.match(/Trident.*rv[ :]*11\./)||-1!==navigator.appVersion.indexOf("MSIE 10"))){$&&o.removeChild($),($=t.createElement("div")).className="pnlm-world",H=v.basePath?v.basePath+v.fallbackPath:v.fallbackPath;var z,F,H,M=["f","r","b","l","u","d"],G=0,Y=function(){var e,n,o=t.createElement("canvas");o.className="pnlm-face pnlm-"+M[this.side]+"face",$.appendChild(o);var i=o.getContext("2d");o.style.width=this.width+4+"px",o.style.height=this.height+4+"px",o.width=this.width+4,o.height=this.height+4,i.drawImage(this,2,2);var a=i.getImageData(0,0,o.width,o.height),r=a.data;for(e=2;e<o.width-2;e++)for(n=0;n<4;n++)r[(e+o.width)*4+n]=r[(e+2*o.width)*4+n],r[(e+o.width*(o.height-2))*4+n]=r[(e+o.width*(o.height-3))*4+n];for(e=2;e<o.height-2;e++)for(n=0;n<4;n++)r[(e*o.width+1)*4+n]=r[(e*o.width+2)*4+n],r[((e+1)*o.width-2)*4+n]=r[((e+1)*o.width-3)*4+n];for(n=0;n<4;n++)r[(o.width+1)*4+n]=r[(2*o.width+2)*4+n],r[(2*o.width-2)*4+n]=r[(3*o.width-3)*4+n],r[(o.width*(o.height-2)+1)*4+n]=r[(o.width*(o.height-3)+2)*4+n],r[(o.width*(o.height-1)-2)*4+n]=r[(o.width*(o.height-2)-3)*4+n];for(e=1;e<o.width-1;e++)for(n=0;n<4;n++)r[4*e+n]=r[(e+o.width)*4+n],r[(e+o.width*(o.height-1))*4+n]=r[(e+o.width*(o.height-2))*4+n];for(e=1;e<o.height-1;e++)for(n=0;n<4;n++)r[e*o.width*4+n]=r[(e*o.width+1)*4+n],r[((e+1)*o.width-1)*4+n]=r[((e+1)*o.width-2)*4+n];for(n=0;n<4;n++)r[n]=r[(o.width+1)*4+n],r[(o.width-1)*4+n]=r[(2*o.width-2)*4+n],r[o.width*(o.height-1)*4+n]=r[(o.width*(o.height-2)+1)*4+n],r[(o.width*o.height-1)*4+n]=r[(o.width*(o.height-1)-2)*4+n];i.putImageData(a,0,0),W.call(this)},W=function(){this.width>0?(p===n&&(p=this.width),p!=this.width&&console.log("Fallback faces have inconsistent widths: "+p+" vs. "+this.width)):D=!0,6==++G&&(p=this.width,o.appendChild($),k())};for(z=0,D=!1;z<6;z++){var X=new Image;X.crossOrigin=P.crossOrigin?P.crossOrigin:"anonymous",X.side=z,X.onload=Y,X.onerror=W,"multires"==g?X.src=H.replace("%s",M[z])+"."+v.extension:X.src=v[z].src}N(p);return}if(!d)throw console.log("Error: no WebGL support detected!"),{type:"no webgl"};"cubemap"==g&&N(F),v.basePath?v.fullpath=v.basePath+v.path:v.fullpath=v.path,v.invTileResolution=1/v.tileResolution;var q=A();for(z=0,m=[];z<6;z++)m[z]=q.slice(12*z,12*z+12),q=A();var Z=0;if("equirectangular"==g){if(Z=d.getParameter(d.MAX_TEXTURE_SIZE),Math.max(v.width/2,v.height)>Z)throw console.log("Error: The image is too big; it's "+v.width+"px wide, but this device's maximum supported size is "+2*Z+"px."),{type:"webgl size error",width:v.width,maxWidth:2*Z}}else if("cubemap"==g&&F>d.getParameter(d.MAX_CUBE_MAP_TEXTURE_SIZE))throw console.log("Error: The image is too big; it's "+F+"px wide, but this device's maximum supported size is "+Z+"px."),{type:"webgl size error",width:F,maxWidth:Z};O!==n&&(n!==O.horizonPitch||n!==O.horizonRoll)&&(_=[n==O.horizonPitch?0:O.horizonPitch,n==O.horizonRoll?0:O.horizonRoll]);var V=d.TEXTURE_2D;if(d.viewport(0,0,d.drawingBufferWidth,d.drawingBufferHeight),d.getShaderPrecisionFormat){var j=d.getShaderPrecisionFormat(d.FRAGMENT_SHADER,d.HIGH_FLOAT);j&&j.precision<1&&(r=r.replace("highp","mediump"))}u=d.createShader(d.VERTEX_SHADER);var K=i;"multires"==g&&(K=a),d.shaderSource(u,K),d.compileShader(u),f=d.createShader(d.FRAGMENT_SHADER);var J=l;"cubemap"==g?(V=d.TEXTURE_CUBE_MAP,J=s):"multires"==g&&(J=c),d.shaderSource(f,J),d.compileShader(f),h=d.createProgram(),d.attachShader(h,u),d.attachShader(h,f),d.linkProgram(h),d.getShaderParameter(u,d.COMPILE_STATUS)||console.log(d.getShaderInfoLog(u)),d.getShaderParameter(f,d.COMPILE_STATUS)||console.log(d.getShaderInfoLog(f)),d.getProgramParameter(h,d.LINK_STATUS)||console.log(d.getProgramInfoLog(h)),d.useProgram(h),h.drawInProgress=!1;var Q=O.backgroundColor?O.backgroundColor:[0,0,0];if(d.clearColor(Q[0],Q[1],Q[2],1),d.clear(d.COLOR_BUFFER_BIT),h.texCoordLocation=d.getAttribLocation(h,"a_texCoord"),d.enableVertexAttribArray(h.texCoordLocation),"multires"!=g){if(w||(w=d.createBuffer()),d.bindBuffer(d.ARRAY_BUFFER,w),d.bufferData(d.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),d.STATIC_DRAW),d.vertexAttribPointer(h.texCoordLocation,2,d.FLOAT,!1,0,0),h.aspectRatio=d.getUniformLocation(h,"u_aspectRatio"),d.uniform1f(h.aspectRatio,d.drawingBufferWidth/d.drawingBufferHeight),h.psi=d.getUniformLocation(h,"u_psi"),h.theta=d.getUniformLocation(h,"u_theta"),h.f=d.getUniformLocation(h,"u_f"),h.h=d.getUniformLocation(h,"u_h"),h.v=d.getUniformLocation(h,"u_v"),h.vo=d.getUniformLocation(h,"u_vo"),h.rot=d.getUniformLocation(h,"u_rot"),d.uniform1f(h.h,C/(2*Math.PI)),d.uniform1f(h.v,I/Math.PI),d.uniform1f(h.vo,S/Math.PI*2),"equirectangular"==g&&(h.backgroundColor=d.getUniformLocation(h,"u_backgroundColor"),d.uniform4fv(h.backgroundColor,Q.concat([1]))),h.texture=d.createTexture(),d.bindTexture(V,h.texture),"cubemap"==g)d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X,0,d.RGB,d.RGB,d.UNSIGNED_BYTE,v[1]),d.texImage2D(d.TEXTURE_CUBE_MAP_NEGATIVE_X,0,d.RGB,d.RGB,d.UNSIGNED_BYTE,v[3]),d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_Y,0,d.RGB,d.RGB,d.UNSIGNED_BYTE,v[4]),d.texImage2D(d.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,d.RGB,d.RGB,d.UNSIGNED_BYTE,v[5]),d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_Z,0,d.RGB,d.RGB,d.UNSIGNED_BYTE,v[0]),d.texImage2D(d.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,d.RGB,d.RGB,d.UNSIGNED_BYTE,v[2]);else if(v.width<=Z)d.uniform1i(d.getUniformLocation(h,"u_splitImage"),0),d.texImage2D(V,0,d.RGB,d.RGB,d.UNSIGNED_BYTE,v);else{d.uniform1i(d.getUniformLocation(h,"u_splitImage"),1);var ee=t.createElement("canvas");ee.width=v.width/2,ee.height=v.height;var et=ee.getContext("2d");et.drawImage(v,0,0);var en=et.getImageData(0,0,v.width/2,v.height);d.texImage2D(V,0,d.RGB,d.RGB,d.UNSIGNED_BYTE,en),h.texture2=d.createTexture(),d.activeTexture(d.TEXTURE1),d.bindTexture(V,h.texture2),d.uniform1i(d.getUniformLocation(h,"u_image1"),1),et.drawImage(v,-v.width/2,0),en=et.getImageData(0,0,v.width/2,v.height),d.texImage2D(V,0,d.RGB,d.RGB,d.UNSIGNED_BYTE,en),d.texParameteri(V,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(V,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(V,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(V,d.TEXTURE_MAG_FILTER,d.LINEAR),d.activeTexture(d.TEXTURE0)}d.texParameteri(V,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(V,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(V,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(V,d.TEXTURE_MAG_FILTER,d.LINEAR)}else h.vertPosLocation=d.getAttribLocation(h,"a_vertCoord"),d.enableVertexAttribArray(h.vertPosLocation),x||(x=d.createBuffer()),b||(b=d.createBuffer()),E||(E=d.createBuffer()),d.bindBuffer(d.ARRAY_BUFFER,b),d.bufferData(d.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),d.STATIC_DRAW),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,E),d.bufferData(d.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),d.STATIC_DRAW),h.perspUniform=d.getUniformLocation(h,"u_perspMatrix"),h.cubeUniform=d.getUniformLocation(h,"u_cubeMatrix"),h.level=-1,h.currentNodes=[],h.nodeCache=[],h.nodeCacheTimestamp=0;var eo=d.getError();if(0!==eo)throw console.log("Error: Something went wrong with WebGL!",eo),{type:"webgl error"};k()},this.destroy=function(){if(o!==n&&(R!==n&&o.contains(R)&&o.removeChild(R),$!==n&&o.contains($)&&o.removeChild($)),d){var e=d.getExtension("WEBGL_lose_context");e&&e.loseContext()}},this.resize=function(){var t=e.devicePixelRatio||1;R.width=R.clientWidth*t,R.height=R.clientHeight*t,d&&(1286==d.getError()&&B(),d.viewport(0,0,d.drawingBufferWidth,d.drawingBufferHeight),"multires"!=g&&d.uniform1f(h.aspectRatio,R.clientWidth/R.clientHeight))},this.resize(),this.setPose=function(e,t){_=[e,t]},this.render=function(e,t,o,i){var a,r,s,l=0;if(i===n&&(i={}),i.roll&&(l=i.roll),_!==n){var c=_[0],u=_[1],f=e,w=t,E=Math.cos(u)*Math.sin(e)*Math.sin(c)+Math.cos(e)*(Math.cos(c)*Math.cos(t)+Math.sin(u)*Math.sin(c)*Math.sin(t)),P=-Math.sin(e)*Math.sin(u)+Math.cos(e)*Math.cos(u)*Math.sin(t),A=[Math.cos(f)*(Math.sin(u)*Math.sin(c)*Math.cos(w)-Math.cos(c)*Math.sin(w)),Math.cos(f)*Math.cos(u)*Math.cos(w),Math.cos(f)*(Math.cos(c)*Math.sin(u)*Math.cos(w)+Math.sin(w)*Math.sin(c))],U=[-Math.cos(e=Math.asin(Math.max(Math.min(Math.cos(u)*Math.cos(c)*Math.sin(e)+Math.cos(e)*(-Math.cos(t)*Math.sin(c)+Math.cos(c)*Math.sin(u)*Math.sin(t)),1),-1)))*Math.sin(t=Math.atan2(P,E)),Math.cos(e)*Math.cos(t)],N=Math.acos(Math.max(Math.min((A[0]*U[0]+A[1]*U[1])/(Math.sqrt(A[0]*A[0]+A[1]*A[1]+A[2]*A[2])*Math.sqrt(U[0]*U[0]+U[1]*U[1])),1),-1));A[2]<0&&(N=2*Math.PI-N),l+=N}if(!d&&("multires"==g||"cubemap"==g)){var B={f:"translate3d(-"+((s=p/2)+2)+"px, -"+(s+2)+"px, -"+s+"px)",b:"translate3d("+(s+2)+"px, -"+(s+2)+"px, "+s+"px) rotateX(180deg) rotateZ(180deg)",u:"translate3d(-"+(s+2)+"px, -"+s+"px, "+(s+2)+"px) rotateX(270deg)",d:"translate3d(-"+(s+2)+"px, "+s+"px, -"+(s+2)+"px) rotateX(90deg)",l:"translate3d(-"+s+"px, -"+(s+2)+"px, "+(s+2)+"px) rotateX(180deg) rotateY(90deg) rotateZ(180deg)",r:"translate3d("+s+"px, -"+(s+2)+"px, -"+(s+2)+"px) rotateY(270deg)"},z=(a=1/Math.tan(o/2))*R.clientWidth/2+"px",F="perspective("+z+") translateZ("+z+") rotateX("+e+"rad) rotateY("+t+"rad) ",H=Object.keys(B);for(r=0;r<6;r++){var M=$.querySelector(".pnlm-"+H[r]+"face");M&&(M.style.webkitTransform=F+B[H[r]],M.style.transform=F+B[H[r]])}return}if("multires"!=g)a=1/Math.tan(.5*(2*Math.atan(Math.tan(.5*o)/(d.drawingBufferWidth/d.drawingBufferHeight)))),d.uniform1f(h.psi,t),d.uniform1f(h.theta,e),d.uniform1f(h.rot,l),d.uniform1f(h.f,a),!0===y&&"equirectangular"==g&&(d.bindTexture(d.TEXTURE_2D,h.texture),d.texImage2D(d.TEXTURE_2D,0,d.RGB,d.RGB,d.UNSIGNED_BYTE,v)),d.drawArrays(d.TRIANGLES,0,6);else{var G,Y,W,X=.1,q=100,Z=(G=o,Y=d.drawingBufferWidth/d.drawingBufferHeight,W=1/Math.tan(2*Math.atan(Math.tan(G/2)*d.drawingBufferHeight/d.drawingBufferWidth)/2),[W/Y,0,0,0,0,W,0,0,0,0,(q+X)/(X-q),2*q*X/(X-q),0,0,-1,0]);(function e(t){for(var n=1;n<v.maxLevel&&d.drawingBufferWidth>v.tileResolution*Math.pow(2,n-1)*Math.tan(t/2)*.707;)n++;h.level=n})(o);var V,j,K,J=[1,0,0,0,1,0,0,0,1];J=S(J,-l,"z"),J=S(J,-e,"x"),J=(V=J=S(J,t,"y"),[V[0],V[1],V[2],0,V[3],V[4],V[5],0,V[6],V[7],V[8],0,0,0,0,1]),d.uniformMatrix4fv(h.perspUniform,!1,new Float32Array(k(Z))),d.uniformMatrix4fv(h.cubeUniform,!1,new Float32Array(k(J)));var Q=(j=Z,K=J,[j[0]*K[0],j[0]*K[1],j[0]*K[2],0,j[5]*K[4],j[5]*K[5],j[5]*K[6],0,j[10]*K[8],j[10]*K[9],j[10]*K[10],j[11],-K[8],-K[9],-K[10],0]);if(h.nodeCache.sort(T),h.nodeCache.length>200&&h.nodeCache.length>h.currentNodes.length+50)for(var ee=h.nodeCache.splice(200,h.nodeCache.length-200),et=0;et<ee.length;et++)d.deleteTexture(ee[et].texture);h.currentNodes=[];var en=["f","b","u","d","l","r"];for(s=0;s<6;s++)I(Q,new C(m[s],en[s],1,0,0,v.fullpath),e,t,o);for(h.currentNodes.sort(L),r=O.length-1;r>=0;r--)-1===h.currentNodes.indexOf(O[r].node)&&(O[r].node.textureLoad=!1,O.splice(r,1));if(0===O.length)for(r=0;r<h.currentNodes.length;r++){var eo=h.currentNodes[r];if(!eo.texture&&!eo.textureLoad){eo.textureLoad=!0,setTimeout(D,0,eo);break}}(function e(){if(!h.drawInProgress){h.drawInProgress=!0,d.clear(d.COLOR_BUFFER_BIT);for(var t=0;t<h.currentNodes.length;t++)h.currentNodes[t].textureLoaded>1&&(d.bindBuffer(d.ARRAY_BUFFER,x),d.bufferData(d.ARRAY_BUFFER,new Float32Array(h.currentNodes[t].vertices),d.STATIC_DRAW),d.vertexAttribPointer(h.vertPosLocation,3,d.FLOAT,!1,0,0),d.bindBuffer(d.ARRAY_BUFFER,b),d.vertexAttribPointer(h.texCoordLocation,2,d.FLOAT,!1,0,0),d.bindTexture(d.TEXTURE_2D,h.currentNodes[t].texture),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0));h.drawInProgress=!1}})()}if(n!==i.returnImage)return R.toDataURL("image/png")},this.isLoading=function(){if(d&&"multires"==g){for(var e=0;e<h.currentNodes.length;e++)if(!h.currentNodes[e].textureLoaded)return!0}return!1},this.getCanvas=function(){return R};var O=[],U=function(){var e,t=4,n={};function o(){var o=this;this.texture=this.callback=null,this.image=new Image,this.image.crossOrigin=e||"anonymous";var i=function(){if(o.image.width>0&&o.image.height>0){var e,i;e=o.image,i=o.texture,d.bindTexture(d.TEXTURE_2D,i),d.texImage2D(d.TEXTURE_2D,0,d.RGB,d.RGB,d.UNSIGNED_BYTE,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.bindTexture(d.TEXTURE_2D,null),o.callback(o.texture,!0)}else o.callback(o.texture,!1);(function e(o){if(O.length){var i=O.shift();o.loadTexture(i.src,i.texture,i.callback)}else n[t++]=o})(o)};this.image.addEventListener("load",i),this.image.addEventListener("error",i)}function i(e,t,n,o){this.node=e,this.src=t,this.texture=n,this.callback=o}o.prototype.loadTexture=function(e,t,n){this.texture=t,this.callback=n,this.image.src=e};for(var a=0;a<t;a++)n[a]=new o;return function(o,a,r,s){e=s;var l=d.createTexture();return t?n[--t].loadTexture(a,l,r):O.push(new i(o,a,l,r)),l}}();function D(e){U(e,e.path+"."+v.extension,function(t,n){e.texture=t,e.textureLoaded=n?2:1},P.crossOrigin)}function N(e,t){var n,o,i=(n=e,o=t,[n[0]*o[0]+n[1]*o[1]+n[2]*o[2],n[4]*o[0]+n[5]*o[1]+n[6]*o[2],n[11]+n[8]*o[0]+n[9]*o[1]+n[10]*o[2],1/(n[12]*o[0]+n[13]*o[1]+n[14]*o[2])]),a=i[0]*i[3],r=i[1]*i[3],s=i[2]*i[3],l=[0,0,0];return a<-1&&(l[0]=-1),a>1&&(l[0]=1),r<-1&&(l[1]=-1),r>1&&(l[1]=1),(s<-1||s>1)&&(l[2]=1),l}function B(){console.log("Reducing canvas size due to error 1286!"),R.width=Math.round(R.width/2),R.height=Math.round(R.height/2)}}var i="attribute vec2 a_texCoord;varying vec2 v_texCoord;void main() {gl_Position = vec4(a_texCoord, 0.0, 1.0);v_texCoord = a_texCoord;}",a="attribute vec3 a_vertCoord;attribute vec2 a_texCoord;uniform mat4 u_cubeMatrix;uniform mat4 u_perspMatrix;varying mediump vec2 v_texCoord;void main(void) {gl_Position = u_perspMatrix * u_cubeMatrix * vec4(a_vertCoord, 1.0);v_texCoord = a_texCoord;}",r="precision highp float;\nuniform float u_aspectRatio;\nuniform float u_psi;\nuniform float u_theta;\nuniform float u_f;\nuniform float u_h;\nuniform float u_v;\nuniform float u_vo;\nuniform float u_rot;\nconst float PI = 3.14159265358979323846264;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nuniform bool u_splitImage;\nuniform samplerCube u_imageCube;\nvarying vec2 v_texCoord;\nuniform vec4 u_backgroundColor;\nvoid main() {\nfloat x = v_texCoord.x * u_aspectRatio;\nfloat y = v_texCoord.y;\nfloat sinrot = sin(u_rot);\nfloat cosrot = cos(u_rot);\nfloat rot_x = x * cosrot - y * sinrot;\nfloat rot_y = x * sinrot + y * cosrot;\nfloat sintheta = sin(u_theta);\nfloat costheta = cos(u_theta);\nfloat a = u_f * costheta - rot_y * sintheta;\nfloat root = sqrt(rot_x * rot_x + a * a);\nfloat lambda = atan(rot_x / root, a / root) + u_psi;\nfloat phi = atan((rot_y * costheta + u_f * sintheta) / root);",s=r+"float cosphi = cos(phi);\ngl_FragColor = textureCube(u_imageCube, vec3(cosphi*sin(lambda), sin(phi), cosphi*cos(lambda)));\n}",l=r+"lambda = mod(lambda + PI, PI * 2.0) - PI;\nvec2 coord = vec2(lambda / PI, phi / (PI / 2.0));\nif(coord.x < -u_h || coord.x > u_h || coord.y < -u_v + u_vo || coord.y > u_v + u_vo)\ngl_FragColor = u_backgroundColor;\nelse {\nif(u_splitImage) {\nif(coord.x < 0.0)\ngl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / u_h, (-coord.y + u_v + u_vo) / (u_v * 2.0)));\nelse\ngl_FragColor = texture2D(u_image1, vec2((coord.x + u_h) / u_h - 1.0, (-coord.y + u_v + u_vo) / (u_v * 2.0)));\n} else {\ngl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / (u_h * 2.0), (-coord.y + u_v + u_vo) / (u_v * 2.0)));\n}\n}\n}",c="varying mediump vec2 v_texCoord;uniform sampler2D u_sampler;void main(void) {gl_FragColor = texture2D(u_sampler, v_texCoord);}";return{renderer:function(e,t,n,i){return new o(e,t,n,i)}}}(window,document),window.pannellum=function(e,t,n){"use strict";function o(o,i){var a,r,s,l,c,h,d,u,f,p=this,$=!1,m=Date.now(),_=0,v=0,g=-1,y=0,w=0,x=Array(10),b=!1,E=!1,P=!1,R=!1,T={yaw:0,pitch:0,hfov:0},L=!1,C=!1,I=0,A=0,S={},k={},O=[],U=!1,D=!1,N=!1,B={hfov:100,minHfov:50,multiResMinHfov:!1,maxHfov:120,pitch:0,minPitch:n,maxPitch:n,yaw:0,minYaw:-180,maxYaw:180,roll:0,haov:360,vaov:180,vOffset:0,autoRotate:!1,autoRotateInactivityDelay:-1,autoRotateStopDelay:n,type:"equirectangular",northOffset:0,showFullscreenCtrl:!0,dynamic:!1,dynamicUpdate:!1,doubleClickZoom:!0,keyboardZoom:!0,mouseZoom:!0,showZoomCtrl:!0,autoLoad:!1,showControls:!0,orientationOnByDefault:!1,hotSpotDebug:!1,backgroundColor:[0,0,0],avoidShowingBackground:!1,animationTimingFunction:function e(t){return t<.5?2*t*t:-1+(4-2*t)*t},draggable:!0,disableKeyboardCtrl:!1,crossOrigin:"anonymous",touchPanSpeedCoeffFactor:1,capturedKeyNumbers:[16,17,27,37,38,39,40,61,65,68,83,87,107,109,173,187,189],friction:.15};B.strings={loadButtonLabel:"Click to<br>Load<br>Panorama",loadingLabel:"Loading...",bylineLabel:"by %s",noPanoramaError:"No panorama image was specified.",fileAccessError:"The file %s could not be accessed.",malformedURLError:"There is something wrong with the panorama URL.",iOS8WebGLError:"Due to iOS 8's broken WebGL implementation, only progressive encoded JPEGs work for your device (this panorama uses standard encoding).",genericWebGLError:"Your browser does not have the necessary WebGL support to display this panorama.",textureSizeError:"This panorama is too big for your device! It's %spx wide, but your device only supports images up to %spx wide. Try another device. (If you're the author, try scaling down the image.)",unknownError:"Unknown error. Check developer console."},(o="string"==typeof o?t.getElementById(o):o).classList.add("pnlm-container"),o.tabIndex=0;var z=t.createElement("div");z.className="pnlm-ui",o.appendChild(z);var F=t.createElement("div");F.className="pnlm-render-container",o.appendChild(F);var H=t.createElement("div");H.className="pnlm-dragfix",z.appendChild(H);var M=t.createElement("span");M.className="pnlm-about-msg",M.innerHTML='<a href="https://pannellum.org/" target="_blank">Pannellum</a>',z.appendChild(M),H.addEventListener("contextmenu",J);var G={},Y=t.createElement("div");Y.className="pnlm-sprite pnlm-hot-spot-debug-indicator",z.appendChild(Y),G.container=t.createElement("div"),G.container.className="pnlm-panorama-info",G.title=t.createElement("div"),G.title.className="pnlm-title-box",G.container.appendChild(G.title),G.author=t.createElement("div"),G.author.className="pnlm-author-box",G.container.appendChild(G.author),z.appendChild(G.container),G.load={},G.load.box=t.createElement("div"),G.load.box.className="pnlm-load-box",G.load.boxp=t.createElement("p"),G.load.box.appendChild(G.load.boxp),G.load.lbox=t.createElement("div"),G.load.lbox.className="pnlm-lbox",G.load.lbox.innerHTML='<div class="pnlm-loading"></div>',G.load.box.appendChild(G.load.lbox),G.load.lbar=t.createElement("div"),G.load.lbar.className="pnlm-lbar",G.load.lbarFill=t.createElement("div"),G.load.lbarFill.className="pnlm-lbar-fill",G.load.lbar.appendChild(G.load.lbarFill),G.load.box.appendChild(G.load.lbar),G.load.msg=t.createElement("p"),G.load.msg.className="pnlm-lmsg",G.load.box.appendChild(G.load.msg),z.appendChild(G.load.box),G.errorMsg=t.createElement("div"),G.errorMsg.className="pnlm-error-msg pnlm-info-box",z.appendChild(G.errorMsg);var W={};W.container=t.createElement("div"),W.container.className="pnlm-controls-container",z.appendChild(W.container),W.load=t.createElement("div"),W.load.className="pnlm-load-button",W.load.addEventListener("click",function(){eT(),e6()}),z.appendChild(W.load),W.zoom=t.createElement("div"),W.zoom.className="pnlm-zoom-controls pnlm-controls",W.zoomIn=t.createElement("div"),W.zoomIn.className="pnlm-zoom-in pnlm-sprite pnlm-control",W.zoomIn.addEventListener("click",function e(){l&&(eA(a.hfov-5),ey())}),W.zoom.appendChild(W.zoomIn),W.zoomOut=t.createElement("div"),W.zoomOut.className="pnlm-zoom-out pnlm-sprite pnlm-control",W.zoomOut.addEventListener("click",function e(){l&&(eA(a.hfov+5),ey())}),W.zoom.appendChild(W.zoomOut),W.container.appendChild(W.zoom),W.fullscreen=t.createElement("div"),W.fullscreen.addEventListener("click",eL),W.fullscreen.className="pnlm-fullscreen-toggle-button pnlm-sprite pnlm-fullscreen-toggle-button-inactive pnlm-controls pnlm-control",(t.fullscreenEnabled||t.mozFullScreenEnabled||t.webkitFullscreenEnabled||t.msFullscreenEnabled)&&W.container.appendChild(W.fullscreen),W.orientation=t.createElement("div"),W.orientation.addEventListener("click",function(e){C?eO():eU()}),W.orientation.addEventListener("mousedown",function(e){e.stopPropagation()}),W.orientation.addEventListener("touchstart",function(e){e.stopPropagation()}),W.orientation.addEventListener("pointerdown",function(e){e.stopPropagation()}),W.orientation.className="pnlm-orientation-button pnlm-orientation-button-inactive pnlm-sprite pnlm-controls pnlm-control";var X=!1;e.DeviceOrientationEvent&&"https:"==location.protocol&&navigator.userAgent.toLowerCase().indexOf("mobi")>=0&&(W.container.appendChild(W.orientation),X=!0);var q=t.createElement("div");function Z(){var o,i,r=t.createElement("div");if(r.innerHTML="<!--[if lte IE 9]><i></i><![endif]-->",1==r.getElementsByTagName("i").length){K();return}if(u=a.hfov,f=a.pitch,"cubemap"==a.type){for(o=0,c=[];o<6;o++)c.push(new Image),c[o].crossOrigin=a.crossOrigin;G.load.lbox.style.display="block",G.load.lbar.style.display="none"}else if("multires"==a.type){var s=JSON.parse(JSON.stringify(a.multiRes));a.basePath&&a.multiRes.basePath&&!/^(?:[a-z]+:)?\/\//i.test(a.multiRes.basePath)?s.basePath=a.basePath+a.multiRes.basePath:a.multiRes.basePath?s.basePath=a.multiRes.basePath:a.basePath&&(s.basePath=a.basePath),c=s}else if(!0===a.dynamic)c=a.panorama;else{if(n===a.panorama){K(a.strings.noPanoramaError);return}c=new Image}if("cubemap"==a.type){var l=6,h=function(){0==--l&&j()},d=function(e){var n=t.createElement("a");n.href=e.target.src,n.textContent=n.href,K(a.strings.fileAccessError.replace("%s",n.outerHTML))};for(o=0;o<c.length;o++)"null"==(i=a.cubeMap[o])?(console.log("Will use background instead of missing cubemap face "+o),h()):(a.basePath&&!V(i)&&(i=a.basePath+i),c[o].onload=h,c[o].onerror=d,c[o].src=eN(i))}else if("multires"==a.type)j();else if(i="",a.basePath&&(i=a.basePath),!0!==a.dynamic){i=V(a.panorama)?a.panorama:i+a.panorama,c.onload=function(){e.URL.revokeObjectURL(this.src),j()};var p=new XMLHttpRequest;p.onloadend=function(){if(200!=p.status){var o,r,s=t.createElement("a");s.href=i,s.textContent=s.href,K(a.strings.fileAccessError.replace("%s",s.outerHTML))}o=this.response,(r=new FileReader).addEventListener("loadend",function(){var t=r.result;if(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)){var i=t.indexOf("\xff\xc2");(i<0||i>65536)&&K(a.strings.iOS8WebGLError)}var s=t.indexOf("<x:xmpmeta");if(s>-1&&!0!==a.ignoreGPanoXMP){var l=t.substring(s,t.indexOf("</x:xmpmeta>")+12),h=function(e){var t;return(l.indexOf(e+'="')>=0?t=(t=l.substring(l.indexOf(e+'="')+e.length+2)).substring(0,t.indexOf('"')):l.indexOf(e+">")>=0&&(t=(t=l.substring(l.indexOf(e+">")+e.length+1)).substring(0,t.indexOf("<"))),t!==n)?Number(t):null},d={fullWidth:h("GPano:FullPanoWidthPixels"),croppedWidth:h("GPano:CroppedAreaImageWidthPixels"),fullHeight:h("GPano:FullPanoHeightPixels"),croppedHeight:h("GPano:CroppedAreaImageHeightPixels"),topPixels:h("GPano:CroppedAreaTopPixels"),heading:h("GPano:PoseHeadingDegrees"),horizonPitch:h("GPano:PosePitchDegrees"),horizonRoll:h("GPano:PoseRollDegrees")};null!==d.fullWidth&&null!==d.croppedWidth&&null!==d.fullHeight&&null!==d.croppedHeight&&null!==d.topPixels&&(0>O.indexOf("haov")&&(a.haov=d.croppedWidth/d.fullWidth*360),0>O.indexOf("vaov")&&(a.vaov=d.croppedHeight/d.fullHeight*180),0>O.indexOf("vOffset")&&(a.vOffset=-(((d.topPixels+d.croppedHeight/2)/d.fullHeight-.5)*180)),null!==d.heading&&0>O.indexOf("northOffset")&&(a.northOffset=d.heading,!1!==a.compass&&(a.compass=!0)),null!==d.horizonPitch&&null!==d.horizonRoll&&(0>O.indexOf("horizonPitch")&&(a.horizonPitch=d.horizonPitch),0>O.indexOf("horizonRoll")&&(a.horizonRoll=d.horizonRoll)))}c.src=e.URL.createObjectURL(o)}),n!==r.readAsBinaryString?r.readAsBinaryString(o):r.readAsText(o),G.load.msg.innerHTML=""},p.onprogress=function(e){if(e.lengthComputable){var t,n,o,i=e.loaded/e.total*100;G.load.lbarFill.style.width=i+"%",e.total>1e6?(t="MB",n=(e.loaded/1e6).toFixed(2),o=(e.total/1e6).toFixed(2)):e.total>1e3?(t="kB",n=(e.loaded/1e3).toFixed(1),o=(e.total/1e3).toFixed(1)):(t="B",n=e.loaded,o=e.total),G.load.msg.innerHTML=n+" / "+o+" "+t}else G.load.lbox.style.display="block",G.load.lbar.style.display="none"};try{p.open("GET",i,!0)}catch($){K(a.strings.malformedURLError)}p.responseType="blob",p.setRequestHeader("Accept","image/*,*/*;q=0.9"),p.withCredentials="use-credentials"===a.crossOrigin,p.send()}a.draggable&&z.classList.add("pnlm-grab"),z.classList.remove("pnlm-grabbing"),U=!0===a.dynamicUpdate,a.dynamic&&U&&(c=a.panorama,j())}function V(e){return RegExp("^(?:[a-z]+:)?//","i").test(e)||"/"==e[0]||"blob:"==e.slice(0,5)}function j(){r||(r=new libpannellum.renderer(F)),!R&&(R=!0,H.addEventListener("mousedown",ee,!1),t.addEventListener("mousemove",eo,!1),t.addEventListener("mouseup",ei,!1),a.mouseZoom&&(z.addEventListener("mousewheel",ef,!1),z.addEventListener("DOMMouseScroll",ef,!1)),a.doubleClickZoom&&H.addEventListener("dblclick",et,!1),o.addEventListener("mozfullscreenchange",eC,!1),o.addEventListener("webkitfullscreenchange",eC,!1),o.addEventListener("msfullscreenchange",eC,!1),o.addEventListener("fullscreenchange",eC,!1),e.addEventListener("resize",eg,!1),e.addEventListener("orientationchange",eg,!1),a.disableKeyboardCtrl||(o.addEventListener("keydown",ep,!1),o.addEventListener("keyup",em,!1),o.addEventListener("blur",e$,!1)),t.addEventListener("mouseleave",ei,!1),""===t.documentElement.style.pointerAction&&""===t.documentElement.style.touchAction?(H.addEventListener("pointerdown",eh,!1),H.addEventListener("pointermove",ed,!1),H.addEventListener("pointerup",eu,!1),H.addEventListener("pointerleave",eu,!1)):(H.addEventListener("touchstart",ea,!1),H.addEventListener("touchmove",er,!1),H.addEventListener("touchend",es,!1)),e.navigator.pointerEnabled&&(o.style.touchAction="none")),function e(){try{var t={};n!==a.horizonPitch&&(t.horizonPitch=a.horizonPitch*Math.PI/180),n!==a.horizonRoll&&(t.horizonRoll=a.horizonRoll*Math.PI/180),n!==a.backgroundColor&&(t.backgroundColor=a.backgroundColor),r.init(c,a.type,a.dynamic,a.haov*Math.PI/180,a.vaov*Math.PI/180,a.vOffset*Math.PI/180,eE,t),!0!==a.dynamic&&(c=n)}catch(o){if("webgl error"==o.type||"no webgl"==o.type)K();else if("webgl size error"==o.type)K(a.strings.textureSizeError.replace("%s",o.width).replace("%s",o.maxWidth));else throw K(a.strings.unknownError),o}}(),eA(a.hfov),setTimeout(function(){P=!0},500)}function K(e){e===n&&(e=a.strings.genericWebGLError),G.errorMsg.innerHTML="<p>"+e+"</p>",W.load.style.display="none",G.load.box.style.display="none",G.errorMsg.style.display="table",E=!0,l=n,F.style.display="none",eB("error",e)}function J(e){var t=Q(e);M.style.left=t.x+"px",M.style.top=t.y+"px",clearTimeout(J.t1),clearTimeout(J.t2),M.style.display="block",M.style.opacity=1,J.t1=setTimeout(function(){M.style.opacity=0},2e3),J.t2=setTimeout(function(){M.style.display="none"},2500),e.preventDefault()}function Q(e){var t=o.getBoundingClientRect(),n={};return n.x=(e.clientX||e.pageX)-t.left,n.y=(e.clientY||e.pageY)-t.top,n}function ee(e){if(e.preventDefault(),o.focus(),l&&a.draggable){var t=Q(e);if(a.hotSpotDebug){var n=en(e);console.log("Pitch: "+n[0]+", Yaw: "+n[1]+", Center Pitch: "+a.pitch+", Center Yaw: "+a.yaw+", HFOV: "+a.hfov)}eS(),eO(),a.roll=0,T.hfov=0,$=!0,m=Date.now(),_=t.x,v=t.y,y=a.yaw,w=a.pitch,z.classList.add("pnlm-grabbing"),z.classList.remove("pnlm-grab"),eB("mousedown",e),ey()}}function et(e){if(a.minHfov===a.hfov)p.setHfov(u,1e3);else{var t=en(e);p.lookAt(t[0],t[1],a.minHfov,1e3)}}function en(e){var t=Q(e),n=r.getCanvas(),o=n.clientWidth,i=n.clientHeight,s=t.x/o*2-1,l=(1-t.y/i*2)*i/o,c=1/Math.tan(a.hfov*Math.PI/360),h=Math.sin(a.pitch*Math.PI/180),d=Math.cos(a.pitch*Math.PI/180),u=c*d-l*h,f=Math.sqrt(s*s+u*u),p=180*Math.atan2(s/f,u/f)/Math.PI+a.yaw;return p<-180&&(p+=360),p>180&&(p-=360),[180*Math.atan((l*d+c*h)/f)/Math.PI,p]}function eo(e){if($&&l){m=Date.now();var t=r.getCanvas(),n=t.clientWidth,o=t.clientHeight,i=Q(e),s=(Math.atan(_/n*2-1)-Math.atan(i.x/n*2-1))*180/Math.PI*a.hfov/90+y;T.yaw=(s-a.yaw)%360*.2,a.yaw=s;var c=2*Math.atan(Math.tan(a.hfov/360*Math.PI)*o/n)*180/Math.PI,h=(Math.atan(i.y/o*2-1)-Math.atan(v/o*2-1))*180/Math.PI*c/90+w;T.pitch=(h-a.pitch)*.2,a.pitch=h}}function ei(e){$&&($=!1,Date.now()-m>15&&(T.pitch=T.yaw=0),z.classList.add("pnlm-grab"),z.classList.remove("pnlm-grabbing"),m=Date.now(),eB("mouseup",e))}function ea(e){if(l&&a.draggable){eS(),eO(),a.roll=0,T.hfov=0;var t=Q(e.targetTouches[0]);if(_=t.x,v=t.y,2==e.targetTouches.length){var n=Q(e.targetTouches[1]);_+=(n.x-t.x)*.5,v+=(n.y-t.y)*.5,g=Math.sqrt((t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y))}$=!0,m=Date.now(),y=a.yaw,w=a.pitch,eB("touchstart",e),ey()}}function er(e){if(a.draggable&&(e.preventDefault(),l&&(m=Date.now()),$&&l)){var t=Q(e.targetTouches[0]),n=t.x,o=t.y;if(2==e.targetTouches.length&&-1!=g){var i=Q(e.targetTouches[1]);n+=(i.x-t.x)*.5,o+=(i.y-t.y)*.5;var r=Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y));eA(a.hfov+(g-r)*.1),g=r}var s=a.hfov/360*a.touchPanSpeedCoeffFactor,c=(_-n)*s+y;T.yaw=(c-a.yaw)%360*.2,a.yaw=c;var h=(o-v)*s+w;T.pitch=(h-a.pitch)*.2,a.pitch=h}}function es(){$=!1,Date.now()-m>150&&(T.pitch=T.yaw=0),g=-1,m=Date.now(),eB("touchend",event)}q.className="pnlm-compass pnlm-controls pnlm-control",z.appendChild(q),i.firstScene?e8(i.firstScene):i.default&&i.default.firstScene?e8(i.default.firstScene):e8(null),eT(!0);var el=[],ec=[];function eh(e){"touch"==e.pointerType&&l&&a.draggable&&(el.push(e.pointerId),ec.push({clientX:e.clientX,clientY:e.clientY}),e.targetTouches=ec,ea(e),e.preventDefault())}function ed(e){if("touch"==e.pointerType&&a.draggable){for(var t=0;t<el.length;t++)if(e.pointerId==el[t]){ec[t].clientX=e.clientX,ec[t].clientY=e.clientY,e.targetTouches=ec,er(e),e.preventDefault();return}}}function eu(e){if("touch"==e.pointerType){for(var t=!1,o=0;o<el.length;o++)e.pointerId==el[o]&&(el[o]=n),el[o]&&(t=!0);t||(el=[],ec=[],es()),e.preventDefault()}}function ef(e){l&&("fullscreenonly"!=a.mouseZoom||b)&&(e.preventDefault(),eS(),m=Date.now(),e.wheelDeltaY?(eA(a.hfov-.05*e.wheelDeltaY),T.hfov=e.wheelDelta<0?1:-1):e.wheelDelta?(eA(a.hfov-.05*e.wheelDelta),T.hfov=e.wheelDelta<0?1:-1):e.detail&&(eA(a.hfov+1.5*e.detail),T.hfov=e.detail>0?1:-1),ey())}function ep(e){eS(),m=Date.now(),eO(),a.roll=0;var t=e.which||e.keycode;!(0>a.capturedKeyNumbers.indexOf(t))&&(e.preventDefault(),27==t?b&&eL():e_(t,!0))}function e$(){for(var e=0;e<10;e++)x[e]=!1}function em(e){var t=e.which||e.keycode;0>a.capturedKeyNumbers.indexOf(t)||(e.preventDefault(),e_(t,!1))}function e_(e,t){var n=!1;switch(e){case 109:case 189:case 17:case 173:x[0]!=t&&(n=!0),x[0]=t;break;case 107:case 187:case 16:case 61:x[1]!=t&&(n=!0),x[1]=t;break;case 38:x[2]!=t&&(n=!0),x[2]=t;break;case 87:x[6]!=t&&(n=!0),x[6]=t;break;case 40:x[3]!=t&&(n=!0),x[3]=t;break;case 83:x[7]!=t&&(n=!0),x[7]=t;break;case 37:x[4]!=t&&(n=!0),x[4]=t;break;case 65:x[8]!=t&&(n=!0),x[8]=t;break;case 39:x[5]!=t&&(n=!0),x[5]=t;break;case 68:x[9]!=t&&(n=!0),x[9]=t}n&&t&&(h="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),ey())}function ev(e){var t=S[e],n=Math.min(1,Math.max((Date.now()-t.startTime)/1e3/(t.duration/1e3),0)),o=t.startPosition+a.animationTimingFunction(n)*(t.endPosition-t.startPosition);(t.endPosition>t.startPosition&&o>=t.endPosition||t.endPosition<t.startPosition&&o<=t.endPosition||t.endPosition===t.startPosition)&&(o=t.endPosition,T[e]=0,delete S[e]),a[e]=o}function eg(){eC("resize")}function ey(){!L&&(L=!0,ew())}function ew(){if(!N){if(function e(){var t;if(l){var o=r.getCanvas();!1!==a.autoRotate&&(a.yaw>360?a.yaw-=360:a.yaw<-360&&(a.yaw+=360)),t=a.yaw;var i=0,s=0;if(a.avoidShowingBackground){var c=a.hfov/2,d=180*Math.atan2(Math.tan(c/180*Math.PI),o.width/o.height)/Math.PI;a.vaov>a.haov?s=d*(1-Math.min(Math.cos((a.pitch-c)/180*Math.PI),Math.cos((a.pitch+c)/180*Math.PI))):i=c*(1-Math.min(Math.cos((a.pitch-d)/180*Math.PI),Math.cos((a.pitch+d)/180*Math.PI)))}var u=a.maxYaw-a.minYaw,f=-180,p=180;u<360&&(f=a.minYaw+a.hfov/2+i,p=a.maxYaw-a.hfov/2-i,u<a.hfov&&(f=p=(f+p)/2),a.yaw=Math.max(f,Math.min(p,a.yaw))),!(!1!==a.autoRotate)&&(a.yaw>360?a.yaw-=360:a.yaw<-360&&(a.yaw+=360)),!1!==a.autoRotate&&t!=a.yaw&&h!==n&&(a.autoRotate*=-1);var $=2*Math.atan(Math.tan(a.hfov/180*Math.PI*.5)/(o.width/o.height))/Math.PI*180,m=a.minPitch+$/2,_=a.maxPitch-$/2;a.maxPitch-a.minPitch<$&&(m=_=(m+_)/2),isNaN(m)&&(m=-90),isNaN(_)&&(_=90),a.pitch=Math.max(m,Math.min(_,a.pitch)),r.render(a.pitch*Math.PI/180,a.yaw*Math.PI/180,a.hfov*Math.PI/180,{roll:a.roll*Math.PI/180}),eR(),a.compass&&(q.style.transform="rotate("+(-a.yaw-a.northOffset)+"deg)",q.style.webkitTransform="rotate("+(-a.yaw-a.northOffset)+"deg)")}}(),d&&clearTimeout(d),$||!0===C)requestAnimationFrame(ew);else if(x[0]||x[1]||x[2]||x[3]||x[4]||x[5]||x[6]||x[7]||x[8]||x[9]||a.autoRotate||S.pitch||S.yaw||S.hfov||Math.abs(T.yaw)>.01||Math.abs(T.pitch)>.01||Math.abs(T.hfov)>.01)(function e(){if(l){var t,o=!1,i=a.pitch,r=a.yaw,s=a.hfov;t="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),h===n&&(h=t);var c=(t-h)*a.hfov/1700;if(c=Math.min(c,1),x[0]&&!0===a.keyboardZoom&&(eA(a.hfov+(.8*T.hfov+.5)*c),o=!0),x[1]&&!0===a.keyboardZoom&&(eA(a.hfov+(.8*T.hfov-.2)*c),o=!0),(x[2]||x[6])&&(a.pitch+=(.8*T.pitch+.2)*c,o=!0),(x[3]||x[7])&&(a.pitch+=(.8*T.pitch-.2)*c,o=!0),(x[4]||x[8])&&(a.yaw+=(.8*T.yaw-.2)*c,o=!0),(x[5]||x[9])&&(a.yaw+=(.8*T.yaw+.2)*c,o=!0),o&&(m=Date.now()),a.autoRotate){if(t-h>.001){var d=(t-h)/1e3,u=(T.yaw/d*c-.2*a.autoRotate)*d;u=(-a.autoRotate>0?1:-1)*Math.min(Math.abs(a.autoRotate*d),Math.abs(u)),a.yaw+=u}a.autoRotateStopDelay&&(a.autoRotateStopDelay-=t-h,a.autoRotateStopDelay<=0&&(a.autoRotateStopDelay=!1,A=a.autoRotate,a.autoRotate=0))}if(S.pitch&&(ev("pitch"),i=a.pitch),S.yaw&&(ev("yaw"),r=a.yaw),S.hfov&&(ev("hfov"),s=a.hfov),c>0&&!a.autoRotate){var f=1-a.friction;x[4]||x[5]||x[8]||x[9]||S.yaw||(a.yaw+=T.yaw*c*f),x[2]||x[3]||x[6]||x[7]||S.pitch||(a.pitch+=T.pitch*c*f),x[0]||x[1]||S.hfov||eA(a.hfov+T.hfov*c*f)}if(h=t,c>0){T.yaw=.8*T.yaw+(a.yaw-r)/c*.2,T.pitch=.8*T.pitch+(a.pitch-i)/c*.2,T.hfov=.8*T.hfov+(a.hfov-s)/c*.2;var p=a.autoRotate?Math.abs(a.autoRotate):5;T.yaw=Math.min(p,Math.max(T.yaw,-p)),T.pitch=Math.min(p,Math.max(T.pitch,-p)),T.hfov=Math.min(p,Math.max(T.hfov,-p))}x[0]&&x[1]&&(T.hfov=0),(x[2]||x[6])&&(x[3]||x[7])&&(T.pitch=0),(x[4]||x[8])&&(x[5]||x[9])&&(T.yaw=0)}})(),a.autoRotateInactivityDelay>=0&&A&&Date.now()-m>a.autoRotateInactivityDelay&&!a.autoRotate&&(a.autoRotate=A,p.lookAt(f,n,u,3e3)),requestAnimationFrame(ew);else if(r&&(r.isLoading()||!0===a.dynamic&&U))requestAnimationFrame(ew);else{eB("animatefinished",{pitch:p.getPitch(),yaw:p.getYaw(),hfov:p.getHfov()}),L=!1,h=n;var e=a.autoRotateInactivityDelay-(Date.now()-m);e>0?d=setTimeout(function(){a.autoRotate=A,p.lookAt(f,n,u,3e3),ey()},e):a.autoRotateInactivityDelay>=0&&A&&(a.autoRotate=A,p.lookAt(f,n,u,3e3),ey())}}}function ex(e,t,n,o){this.w=e,this.x=t,this.y=n,this.z=o}function eb(t){var n,o,i,r,s,l,c,h,d,u,f,p=(n=t.alpha,o=t.beta,i=t.gamma,u=(u=(r=n,s=o,l=i,h=[Math.cos((c=[s?s*Math.PI/180/2:0,l?l*Math.PI/180/2:0,r?r*Math.PI/180/2:0])[0]),Math.cos(c[1]),Math.cos(c[2])],d=[Math.sin(c[0]),Math.sin(c[1]),Math.sin(c[2])],new ex(h[0]*h[1]*h[2]-d[0]*d[1]*d[2],d[0]*h[1]*h[2]-h[0]*d[1]*d[2],h[0]*d[1]*h[2]+d[0]*h[1]*d[2],h[0]*h[1]*d[2]+d[0]*d[1]*h[2]))).multiply(new ex(Math.sqrt(.5),-Math.sqrt(.5),0,0)),f=e.orientation?-e.orientation*Math.PI/180/2:0,u.multiply(new ex(Math.cos(f),0,-Math.sin(f),0))).toEulerAngles();"number"==typeof C&&C<10?C+=1:10===C?(I=p[2]/Math.PI*180+a.yaw,C=!0,requestAnimationFrame(ew)):(a.pitch=p[0]/Math.PI*180,a.roll=-p[1]/Math.PI*180,a.yaw=-p[2]/Math.PI*180+I)}function eE(){if(a.sceneFadeDuration&&n!==r.fadeImg){r.fadeImg.style.opacity=0;var e=r.fadeImg;delete r.fadeImg,setTimeout(function(){F.removeChild(e),eB("scenechangefadedone")},a.sceneFadeDuration)}a.compass?q.style.display="inline":q.style.display="none",D||(a.hotSpots?(a.hotSpots=a.hotSpots.sort(function(e,t){return e.pitch<t.pitch}),a.hotSpots.forEach(e0)):a.hotSpots=[],D=!0,eR()),G.load.box.style.display="none",s!==n&&(F.removeChild(s),s=n),l=!0,eB("load"),ey()}function e0(e){e.pitch=Number(e.pitch)||0,e.yaw=Number(e.yaw)||0;var n,o=t.createElement("div");o.className="pnlm-hotspot-base",e.cssClass?o.className+=" "+e.cssClass:o.className+=" pnlm-hotspot pnlm-sprite pnlm-"+eD(e.type);var i=t.createElement("span");if(e.text&&(i.innerHTML=eD(e.text)),e.video){var r=t.createElement("video"),s=e.video;a.basePath&&!V(s)&&(s=a.basePath+s),r.src=eN(s),r.controls=!0,r.style.width=e.width+"px",F.appendChild(o),i.appendChild(r)}else if(e.image){var l=e.image;a.basePath&&!V(l)&&(l=a.basePath+l),(n=t.createElement("a")).href=eN(e.URL?e.URL:l,!0),n.target="_blank",i.appendChild(n);var c=t.createElement("img");c.src=eN(l),c.style.width=e.width+"px",c.style.paddingTop="5px",F.appendChild(o),n.appendChild(c),i.style.maxWidth="initial"}else if(e.URL){if((n=t.createElement("a")).href=eN(e.URL,!0),e.attributes)for(var h in e.attributes)n.setAttribute(h,e.attributes[h]);else n.target="_blank";F.appendChild(n),o.className+=" pnlm-pointer",i.className+=" pnlm-pointer",n.appendChild(o)}else e.sceneId&&(o.onclick=o.ontouchend=function(){return o.clicked||(o.clicked=!0,p.setHfov(p.getHfov()-120),p.lookAt(e.pitch,e.yaw,p.getConfig.minHfov,800),setTimeout(function(){ek(e.sceneId,e.targetPitch,e.targetYaw,e.targetHfov)},800)),!1},o.className+=" pnlm-pointer",i.className+=" pnlm-pointer"),F.appendChild(o);e.createTooltipFunc?e.createTooltipFunc(o,e.createTooltipArgs):(e.text||e.video||e.image)&&(o.classList.add("pnlm-tooltip"),o.appendChild(i),i.style.width=i.scrollWidth-20+"px",i.style.marginLeft=-(i.scrollWidth-o.offsetWidth)/2+"px",i.style.marginTop=-i.scrollHeight-12+"px"),e.clickHandlerFunc&&(o.addEventListener("click",function(t){e.clickHandlerFunc(t,e.clickHandlerArgs)},"false"),o.className+=" pnlm-pointer",i.className+=" pnlm-pointer"),e.div=o}function eP(e){var t=Math.sin(e.pitch*Math.PI/180),n=Math.cos(e.pitch*Math.PI/180),o=Math.sin(a.pitch*Math.PI/180),i=Math.cos(a.pitch*Math.PI/180),s=Math.cos((-e.yaw+a.yaw)*Math.PI/180),l=t*o+n*s*i;if(e.yaw<=90&&e.yaw>-90&&l<=0||(e.yaw>90||e.yaw<=-90)&&l<=0)e.div.style.visibility="hidden";else{var c=Math.sin((-e.yaw+a.yaw)*Math.PI/180),h=Math.tan(a.hfov*Math.PI/360);e.div.style.visibility="visible";var d=r.getCanvas(),f=d.clientWidth,p=d.clientHeight,$=[-f/h*c*n/l/2,-f/h*(t*i-n*s*o)/l/2],m=Math.sin(a.roll*Math.PI/180),_=Math.cos(a.roll*Math.PI/180);$=[$[0]*_-$[1]*m,$[0]*m+$[1]*_],$[0]+=(f-e.div.offsetWidth)/2,$[1]+=(p-e.div.offsetHeight)/2;var v="translate("+$[0]+"px, "+$[1]+"px) translateZ(9999px) rotate("+a.roll+"deg)";e.scale&&(v+=" scale("+u/a.hfov/l+")"),e.div.style.webkitTransform=v,e.div.style.MozTransform=v,e.div.style.transform=v}}function eR(){a.hotSpots.forEach(eP)}function e8(e){a={};var t,n,o=["haov","vaov","vOffset","northOffset","horizonPitch","horizonRoll"];for(t in O=[],B)B.hasOwnProperty(t)&&(a[t]=B[t]);for(t in i.default)if(i.default.hasOwnProperty(t)){if("strings"==t)for(n in i.default.strings)i.default.strings.hasOwnProperty(n)&&(a.strings[n]=eD(i.default.strings[n]));else a[t]=i.default[t],o.indexOf(t)>=0&&O.push(t)}if(null!==e&&""!==e&&i.scenes&&i.scenes[e]){var r=i.scenes[e];for(t in r)if(r.hasOwnProperty(t)){if("strings"==t)for(n in r.strings)r.strings.hasOwnProperty(n)&&(a.strings[n]=eD(r.strings[n]));else a[t]=r[t],o.indexOf(t)>=0&&O.push(t)}a.scene=e}for(t in i)if(i.hasOwnProperty(t)){if("strings"==t)for(n in i.strings)i.strings.hasOwnProperty(n)&&(a.strings[n]=eD(i.strings[n]));else a[t]=i[t],o.indexOf(t)>=0&&O.push(t)}}function eT(e){if((e=!!e&&e)&&"preview"in a){var o,i=a.preview;a.basePath&&!V(i)&&(i=a.basePath+i),(s=t.createElement("div")).className="pnlm-preview-img",s.style.backgroundImage="url('"+(o=i,eN(o).replace(/"/g,"%22").replace(/'/g,"%27"))+"')",F.appendChild(s)}var l=a.title,c=a.author;for(var h in e&&("previewTitle"in a&&(a.title=a.previewTitle),"previewAuthor"in a&&(a.author=a.previewAuthor)),a.hasOwnProperty("title")||(G.title.innerHTML=""),a.hasOwnProperty("author")||(G.author.innerHTML=""),a.hasOwnProperty("title")||a.hasOwnProperty("author")||(G.container.style.display="none"),W.load.innerHTML="<p>"+a.strings.loadButtonLabel+"</p>",G.load.boxp.innerHTML=a.strings.loadingLabel,a)if(a.hasOwnProperty(h))switch(h){case"title":G.title.innerHTML=eD(a[h]),G.container.style.display="inline";break;case"author":var d=eD(a[h]);if(a.authorURL){var u=t.createElement("a");u.href=eN(a.authorURL,!0),u.target="_blank",u.innerHTML=eD(a[h]),d=u.outerHTML}G.author.innerHTML=a.strings.bylineLabel.replace("%s",d),G.container.style.display="inline";break;case"fallback":var f=t.createElement("a");f.href=eN(a[h],!0),f.target="_blank",f.textContent="Click here to view this panorama in an alternative viewer.";var p=t.createElement("p");p.textContent="Your browser does not support WebGL.",p.appendChild(t.createElement("br")),p.appendChild(f),G.errorMsg.innerHTML="",G.errorMsg.appendChild(p);break;case"hfov":eA(Number(a[h]));break;case"autoLoad":!0===a[h]&&r===n&&(G.load.box.style.display="inline",W.load.style.display="none",Z());break;case"showZoomCtrl":a[h]&&!1!=a.showControls?W.zoom.style.display="block":W.zoom.style.display="none";break;case"showFullscreenCtrl":a[h]&&!1!=a.showControls&&("fullscreen"in t||"mozFullScreen"in t||"webkitIsFullScreen"in t||"msFullscreenElement"in t)?W.fullscreen.style.display="block":W.fullscreen.style.display="none";break;case"hotSpotDebug":a[h]?Y.style.display="block":Y.style.display="none";break;case"showControls":a[h]||(W.orientation.style.display="none",W.zoom.style.display="none",W.fullscreen.style.display="none");break;case"orientationOnByDefault":a[h]&&eU()}e&&(l?a.title=l:delete a.title,c?a.author=c:delete a.author)}function eL(){if(l&&!E){if(b)t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen?t.webkitCancelFullScreen():t.msExitFullscreen&&t.msExitFullscreen();else try{o.requestFullscreen?o.requestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.msRequestFullscreen?o.msRequestFullscreen():o.webkitRequestFullScreen()}catch(e){}}}function eC(e){t.fullscreenElement||t.fullscreen||t.mozFullScreen||t.webkitIsFullScreen||t.msFullscreenElement?(W.fullscreen.classList.add("pnlm-fullscreen-toggle-button-active"),b=!0):(W.fullscreen.classList.remove("pnlm-fullscreen-toggle-button-active"),b=!1),"resize"!==e&&eB("fullscreenchange",b),r.resize(),eA(a.hfov),ey()}function eI(e){var t=a.minHfov;if("multires"==a.type&&r&&!a.multiResMinHfov&&(t=Math.min(t,r.getCanvas().width/(a.multiRes.cubeResolution/90*.9))),t>a.maxHfov)return console.log("HFOV bounds do not make sense (minHfov > maxHfov)."),a.hfov;var n=a.hfov;if(n=e<t?t:e>a.maxHfov?a.maxHfov:e,a.avoidShowingBackground&&r){var o=r.getCanvas();n=Math.min(n,360*Math.atan(Math.tan((a.maxPitch-a.minPitch)/360*Math.PI)/o.height*o.width)/Math.PI)}return n}function eA(e){a.hfov=eI(e),eB("zoomchange",a.hfov)}function eS(){S={},A=a.autoRotate?a.autoRotate:A,a.autoRotate=!1}function e6(){E&&(G.load.box.style.display="none",G.errorMsg.style.display="none",E=!1,F.style.display="block",eB("errorcleared")),l=!1,W.load.style.display="none",G.load.box.style.display="inline",Z()}function ek(e,t,o,s,c){if(l||(c=!0),l=!1,S={},a.sceneFadeDuration&&!c){var h,d,u,f,p=r.render(a.pitch*Math.PI/180,a.yaw*Math.PI/180,a.hfov*Math.PI/180,{returnImage:!0});if(p!==n){(h=new Image).className="pnlm-fade-img",h.style.transition="opacity "+a.sceneFadeDuration/1e3+"s",h.style.width="100%",h.style.height="100%",h.onload=function(){ek(e,t,o,s,!0)},h.src=p,F.appendChild(h),r.fadeImg=h;return}}d="same"===t?a.pitch:t,u="same"===o?a.yaw:"sameAzimuth"===o?a.yaw+(a.northOffset||0)-(i.scenes[e].northOffset||0):o,f="same"===s?a.hfov:s,function e(){var t=a.hotSpots;if(D=!1,delete a.hotSpots,t)for(var n=0;n<t.length;n++){var o=t[n].div;if(o){for(;o.parentNode&&o.parentNode!=F;)o=o.parentNode;F.removeChild(o)}delete t[n].div}}(),e8(e),T.yaw=T.pitch=T.hfov=0,eT(),d!==n&&(a.pitch=d),u!==n&&(a.yaw=u),f!==n&&(a.hfov=f),eB("scenechange",e),e6()}function eO(){e.removeEventListener("deviceorientation",eb),W.orientation.classList.remove("pnlm-orientation-button-active"),C=!1}function eU(){"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(function(t){"granted"==t&&(C=1,e.addEventListener("deviceorientation",eb),W.orientation.classList.add("pnlm-orientation-button-active"))}):(C=1,e.addEventListener("deviceorientation",eb),W.orientation.classList.add("pnlm-orientation-button-active"))}function eD(e){return i.escapeHTML?String(e).split(/&/g).join("&amp;").split('"').join("&quot;").split("'").join("&#39;").split("<").join("&lt;").split(">").join("&gt;").split("/").join("&#x2f;").split("\n").join("<br>"):String(e).split("\n").join("<br>")}function eN(e,t){try{var n,o=decodeURIComponent((n=e,n.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,function(e,t){return"colon"===(t=t.toLowerCase())?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""}))).replace(/[^\w:]/g,"").toLowerCase()}catch(i){return"about:blank"}return 0===o.indexOf("javascript:")||0===o.indexOf("vbscript:")?(console.log("Script URL removed."),"about:blank"):t&&0===o.indexOf("data:")?(console.log("Data URI removed from link."),"about:blank"):e}function eB(e){if(e in k)for(var t=k[e].length;t>0;t--)k[e][k[e].length-t].apply(null,[].slice.call(arguments,1))}ex.prototype.multiply=function(e){return new ex(this.w*e.w-this.x*e.x-this.y*e.y-this.z*e.z,this.x*e.w+this.w*e.x+this.y*e.z-this.z*e.y,this.y*e.w+this.w*e.y+this.z*e.x-this.x*e.z,this.z*e.w+this.w*e.z+this.x*e.y-this.y*e.x)},ex.prototype.toEulerAngles=function(){var e,t=Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y));return[t,Math.asin(2*(this.w*this.y-this.z*this.x)),Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z))]},this.isLoaded=function(){return Boolean(l)},this.getPitch=function(){return a.pitch},this.setPitch=function(e,t,o,i){return(m=Date.now(),1e-6>=Math.abs(e-a.pitch))?("function"==typeof o&&o(i),this):((t=t==n?1e3:Number(t))?(S.pitch={startTime:Date.now(),startPosition:a.pitch,endPosition:e,duration:t},"function"==typeof o&&setTimeout(function(){o(i)},t)):a.pitch=e,ey(),this)},this.getPitchBounds=function(){return[a.minPitch,a.maxPitch]},this.setPitchBounds=function(e){return a.minPitch=Math.max(-90,Math.min(e[0],90)),a.maxPitch=Math.max(-90,Math.min(e[1],90)),this},this.getYaw=function(){return(a.yaw+540)%360-180},this.setYaw=function(e,t,o,i){return(m=Date.now(),1e-6>=Math.abs(e-a.yaw))?("function"==typeof o&&o(i),this):(t=t==n?1e3:Number(t),e=(e+180)%360-180,t?(a.yaw-e>180?e+=360:e-a.yaw>180&&(e-=360),S.yaw={startTime:Date.now(),startPosition:a.yaw,endPosition:e,duration:t},"function"==typeof o&&setTimeout(function(){o(i)},t)):a.yaw=e,ey(),this)},this.getYawBounds=function(){return[a.minYaw,a.maxYaw]},this.setYawBounds=function(e){return a.minYaw=Math.max(-360,Math.min(e[0],360)),a.maxYaw=Math.max(-360,Math.min(e[1],360)),this},this.getHfov=function(){return a.hfov},this.setHfov=function(e,t,o,i){return(m=Date.now(),1e-6>=Math.abs(e-a.hfov))?("function"==typeof o&&o(i),this):((t=t==n?1e3:Number(t))?(S.hfov={startTime:Date.now(),startPosition:a.hfov,endPosition:eI(e),duration:t},"function"==typeof o&&setTimeout(function(){o(i)},t)):eA(e),ey(),this)},this.getHfovBounds=function(){return[a.minHfov,a.maxHfov]},this.setHfovBounds=function(e){return a.minHfov=Math.max(0,e[0]),a.maxHfov=Math.max(0,e[1]),this},this.lookAt=function(e,t,o,i,r,s){return i=i==n?1e3:Number(i),e!==n&&Math.abs(e-a.pitch)>1e-6&&(this.setPitch(e,i,r,s),r=n),t!==n&&Math.abs(t-a.yaw)>1e-6&&(this.setYaw(t,i,r,s),r=n),o!==n&&Math.abs(o-a.hfov)>1e-6&&(this.setHfov(o,i,r,s),r=n),"function"==typeof r&&r(s),this},this.getNorthOffset=function(){return a.northOffset},this.setNorthOffset=function(e){return a.northOffset=Math.min(360,Math.max(0,e)),ey(),this},this.getHorizonRoll=function(){return a.horizonRoll},this.setHorizonRoll=function(e){return a.horizonRoll=Math.min(90,Math.max(-90,e)),r.setPose(a.horizonPitch*Math.PI/180,a.horizonRoll*Math.PI/180),ey(),this},this.getHorizonPitch=function(){return a.horizonPitch},this.setHorizonPitch=function(e){return a.horizonPitch=Math.min(90,Math.max(-90,e)),r.setPose(a.horizonPitch*Math.PI/180,a.horizonRoll*Math.PI/180),ey(),this},this.startAutoRotate=function(e,t){return e=e||A||1,t=t===n?f:t,a.autoRotate=e,p.lookAt(t,n,u,3e3),ey(),this},this.stopAutoRotate=function(){return A=a.autoRotate?a.autoRotate:A,a.autoRotate=!1,a.autoRotateInactivityDelay=-1,this},this.stopMovement=function(){eS(),T={yaw:0,pitch:0,hfov:0}},this.getRenderer=function(){return r},this.setUpdate=function(e){return U=!0===e,r===n?j():ey(),this},this.mouseEventToCoords=function(e){return en(e)},this.loadScene=function(e,t,n,o){return!1!==l&&ek(e,t,n,o),this},this.getScene=function(){return a.scene},this.addScene=function(e,t){return i.scenes[e]=t,this},this.removeScene=function(e){return!!(a.scene!==e&&i.scenes.hasOwnProperty(e))&&(delete i.scenes[e],!0)},this.toggleFullscreen=function(){return eL(),this},this.getConfig=function(){return a},this.getContainer=function(){return o},this.addHotSpot=function(e,t){if(t===n&&n===a.scene)a.hotSpots.push(e);else{var o=t!==n?t:a.scene;if(i.scenes.hasOwnProperty(o))i.scenes[o].hasOwnProperty("hotSpots")||(i.scenes[o].hotSpots=[],o!=a.scene||(a.hotSpots=i.scenes[o].hotSpots)),i.scenes[o].hotSpots.push(e);else throw"Invalid scene ID!"}return(t===n||a.scene==t)&&(e0(e),l&&eP(e)),this},this.removeHotSpot=function(e,t){if(t===n||a.scene==t){if(!a.hotSpots)return!1;for(var o=0;o<a.hotSpots.length;o++)if(a.hotSpots[o].hasOwnProperty("id")&&a.hotSpots[o].id===e){for(var r=a.hotSpots[o].div;r.parentNode!=F;)r=r.parentNode;return F.removeChild(r),delete a.hotSpots[o].div,a.hotSpots.splice(o,1),!0}}else{if(!i.scenes.hasOwnProperty(t)||!i.scenes[t].hasOwnProperty("hotSpots"))return!1;for(var s=0;s<i.scenes[t].hotSpots.length;s++)if(i.scenes[t].hotSpots[s].hasOwnProperty("id")&&i.scenes[t].hotSpots[s].id===e)return i.scenes[t].hotSpots.splice(s,1),!0}},this.resize=function(){r&&eg()},this.isLoaded=function(){return l},this.isOrientationSupported=function(){return X||!1},this.stopOrientation=function(){eO()},this.startOrientation=function(){X&&eU()},this.isOrientationActive=function(){return Boolean(C)},this.on=function(e,t){return k[e]=k[e]||[],k[e].push(t),this},this.off=function(e,t){if(!e)return k={},this;if(t){var n=k[e].indexOf(t);n>=0&&k[e].splice(n,1),0==k[e].length&&delete k[e]}else delete k[e];return this},this.destroy=function(){N=!0,clearTimeout(d),r&&r.destroy(),R&&(t.removeEventListener("mousemove",eo,!1),t.removeEventListener("mouseup",ei,!1),o.removeEventListener("mozfullscreenchange",eC,!1),o.removeEventListener("webkitfullscreenchange",eC,!1),o.removeEventListener("msfullscreenchange",eC,!1),o.removeEventListener("fullscreenchange",eC,!1),e.removeEventListener("resize",eg,!1),e.removeEventListener("orientationchange",eg,!1),o.removeEventListener("keydown",ep,!1),o.removeEventListener("keyup",em,!1),o.removeEventListener("blur",e$,!1),t.removeEventListener("mouseleave",ei,!1)),o.innerHTML="",o.classList.remove("pnlm-container")}}return{viewer:function(e,t){return new o(e,t)}}}(window,document);